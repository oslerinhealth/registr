<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Generalized functional principal component analysis — gfpca_twoStep • registr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Generalized functional principal component analysis — gfpca_twoStep" />
<meta property="og:description" content="Function for applying FPCA to different exponential family distributions.
Used in the FPCA step for registering functional data,
called by register_fpca when fpca_type = &quot;two-step&quot;.  
The method implements the `two-step approach` of Gertheiss et al. (2017)
and is based on the approach of Hall et al. (2008) to estimate functional
principal components.  
The number of functional principal components (FPCs) can either be specified
directly (argument npc) or chosen based on the explained share of
variance (npc_criterion). Using the latter, we approximate the overall
variance in the data Y with the variance represented by the smoothed
covariance surface estimated with cov_hall.
Note that the Eigenvalue decomposition of this covariance surface
sometimes leads to a long tail of subordinate FPCs with small eigenvalues.
Such subordinate dimensions seem to often represent phase rather than
amplitude variation, and can be cut off by specifying the second element of
argument npc_criterion.  
This function is an adaptation of the implementation of Jan
Gertheiss for Gertheiss et al. (2017), with focus on higher (RAM) efficiency
for large data settings." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">registr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/registr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/incomplete_curves.html">Registering Incomplete Curves</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generalized functional principal component analysis</h1>
    
    <div class="hidden name"><code>gfpca_twoStep.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function for applying FPCA to different exponential family distributions.
Used in the FPCA step for registering functional data,
called by <code><a href='register_fpca.html'>register_fpca</a></code> when <code>fpca_type = "two-step"</code>. <br /> <br />
The method implements the `two-step approach` of Gertheiss et al. (2017)
and is based on the approach of Hall et al. (2008) to estimate functional
principal components. <br /> <br />
The number of functional principal components (FPCs) can either be specified
directly (argument <code>npc</code>) or chosen based on the explained share of
variance (<code>npc_criterion</code>). Using the latter, we approximate the overall
variance in the data <code>Y</code> with the variance represented by the smoothed
covariance surface estimated with <code><a href='cov_hall.html'>cov_hall</a></code>.
Note that the Eigenvalue decomposition of this covariance surface
sometimes leads to a long tail of subordinate FPCs with small eigenvalues.
Such subordinate dimensions seem to often represent phase rather than
amplitude variation, and can be cut off by specifying the second element of
argument <code>npc_criterion</code>. <br /> <br />
This function is an adaptation of the implementation of Jan
Gertheiss for Gertheiss et al. (2017), with focus on higher (RAM) efficiency
for large data settings.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>gfpca_twoStep</span><span class='op'>(</span>
  <span class='va'>Y</span>,
  family <span class='op'>=</span> <span class='st'>"gaussian"</span>,
  npc <span class='op'>=</span> <span class='cn'>NULL</span>,
  npc_criterion <span class='op'>=</span> <span class='cn'>NULL</span>,
  Kt <span class='op'>=</span> <span class='fl'>8</span>,
  t_min <span class='op'>=</span> <span class='cn'>NULL</span>,
  t_max <span class='op'>=</span> <span class='cn'>NULL</span>,
  row_obj <span class='op'>=</span> <span class='cn'>NULL</span>,
  index_significantDigits <span class='op'>=</span> <span class='fl'>4L</span>,
  estimation_accuracy <span class='op'>=</span> <span class='st'>"high"</span>,
  start_params <span class='op'>=</span> <span class='cn'>NULL</span>,
  periodic <span class='op'>=</span> <span class='cn'>FALSE</span>,
  verbose <span class='op'>=</span> <span class='fl'>1</span>,
  <span class='va'>...</span>
<span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>Dataframe. Should have values id, value, index.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>One of <code>c("gaussian","binomial","gamma","poisson")</code>.
Poisson data are rounded before performing
the GFPCA to ensure integer data, see Details section below.
Defaults to <code>"gaussian"</code>.</p></td>
    </tr>
    <tr>
      <th>npc, npc_criterion</th>
      <td><p>The number of functional principal components (FPCs)
has to be specified either directly as <code>npc</code> or based on their explained
share of variance. In the latter case, <code>npc_criterion</code> can either be set
to (i) a share between 0 and 1, or (ii) a vector with two elements comprising
the targeted explained share of variance and a cut-off scree plot criterion,
both between 0 and 1. As an example for the latter,
<code>npc_criterion = c(0.9,0.02)</code> tries to choose a number of FPCs that
explains at least 90% of variation, but only includes FPCs that explain at
least 2% of variation (even if this means 90% explained variation is not reached).</p></td>
    </tr>
    <tr>
      <th>Kt</th>
      <td><p>Number of B-spline basis functions used to estimate mean functions
and functional principal components. Default is 8. If
<code>fpca_type = "variationalEM"</code> and <code>npc_criterion</code> is used,
<code>Kt</code> is set to 20.</p></td>
    </tr>
    <tr>
      <th>t_min</th>
      <td><p>Minimum value to be evaluated on the time domain.</p></td>
    </tr>
    <tr>
      <th>t_max</th>
      <td><p>Maximum value to be evaluated on the time domain.</p></td>
    </tr>
    <tr>
      <th>row_obj</th>
      <td><p>If NULL, the function cleans the data and calculates row indices. 
Keep this NULL if you are using standalone <code>register</code> function.</p></td>
    </tr>
    <tr>
      <th>index_significantDigits</th>
      <td><p>Positive integer <code>&gt;= 2</code>, stating the number
of significant digits to which the index grid should be rounded. Coarsening the
index grid is necessary since otherwise the covariance surface matrix
explodes in size in the presence of too many unique index values (which is
always the case after some registration step). Defaults to 4. Set to
<code>NULL</code> to prevent rounding.</p></td>
    </tr>
    <tr>
      <th>estimation_accuracy</th>
      <td><p>One of <code>c("high","low")</code>. When set to <code>"low"</code>,
the mixed model estimation step in <code>lme4</code> is performed with lower
accuracy, reducing computation time. Defaults to <code>"high"</code>.</p></td>
    </tr>
    <tr>
      <th>start_params</th>
      <td><p>Optional start values for gamm4. Not used if
<code>npc_criterion</code> is specified.</p></td>
    </tr>
    <tr>
      <th>periodic</th>
      <td><p>Only contained for full consistency with <code>fpca_gauss</code>
and <code>bfpca</code>. If TRUE, returns the knots vector for periodic b-spline
basis functions. Defaults to FALSE. This parameter does not change the
results of the two-step GFPCA.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Can be set to integers between 0 and 4 to control the level of
detail of the printed diagnostic messages. Higher numbers lead to more detailed
messages. Defaults to 1.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to <code><a href='cov_hall.html'>cov_hall</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>fpca</code> containing:</p>
<dt>fpca_type</dt><dd><p>Information that FPCA was performed with the 'two-step' approach,
in contrast to registr::fpca_gauss or registr::bfpca.</p></dd>
<dt>t_vec</dt><dd><p>Time vector over which the mean <code>mu</code> was evaluated.
The resolution is can be specified by setting <code>index_significantDigits</code>.</p></dd>
<dt>knots</dt><dd><p>Cutpoints for B-spline basis used to rebuild <code>alpha</code>.</p></dd>
<dt>efunctions</dt><dd><p>\(D \times npc\) matrix of estimated FPC basis functions.</p></dd>
<dt>evalues</dt><dd><p>Estimated variance of the FPC scores.</p></dd>
<dt>evalues_sum</dt><dd><p>Sum of all (nonnegative) eigenvalues of the smoothed
covariance surface estimated with <code><a href='cov_hall.html'>cov_hall</a></code>. Can be used as an
approximation for the total variance present in <code>Y</code> to compute the
shares of explained variance of the FPC scores.</p></dd>
<dt>npc</dt><dd><p>number of FPCs.</p></dd>
<dt>scores</dt><dd><p>\(I \times npc\) matrix of estimated FPC scores.</p></dd>
<dt>alpha</dt><dd><p>Estimated population-level mean.</p></dd>
<dt>mu</dt><dd><p>Estimated population-level mean. Same value as <code>alpha</code> but included for compatibility
with <code>refund.shiny</code> package.</p></dd>
<dt>subject_coefs</dt><dd><p>Always <code>NA</code> but included for full consistency
with <code>fpca_gauss</code> and <code>bfpca</code>.</p></dd> 
<dt>Yhat</dt><dd><p>FPC approximation of subject-specific means, before applying the
response function.</p></dd>
<dt>Y</dt><dd><p>The observed data.</p></dd>
<dt>family</dt><dd><p><code>binomial</code>, for compatibility with <code>refund.shiny</code> package.</p></dd>
<dt>gamm4_theta</dt><dd><p>Estimated parameters of the mixed model.</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For <code>family = "poisson"</code> the values in <code>Y</code> are rounded before
performing the GFPCA to ensure integer data. This is done to ensure reasonable
computation times. Computation times tend to explode when estimating the
underlying high-dimensional mixed model with continuous Poisson data based
on the <code>gamm4</code> package.</p>
<p>If negative eigenvalues are present, the respective eigenfunctions are dropped
and not considered further.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Gertheiss, J., Goldsmith, J., &amp; Staicu, A. M. (2017). A note on
modeling sparse exponential-family functional response curves.
<em>Computational statistics &amp; data analysis</em>, 105, 46--52.</p>
<p>Hall, P., Müller, H. G., &amp; Yao, F. (2008). Modelling sparse
generalized longitudinal observations with latent Gaussian processes.
<em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em>,
70(4), 703--723.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Alexander Bauer <a href='mailto:alexander.bauer@stat.uni-muenchen.de'>alexander.bauer@stat.uni-muenchen.de</a>,
based on work of Jan Gertheiss</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>growth_incomplete</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># estimate 2 FPCs</span></span>
<span class='r-in'><span class='va'>fpca_obj</span> <span class='op'>=</span> <span class='fu'>gfpca_twoStep</span><span class='op'>(</span>Y <span class='op'>=</span> <span class='va'>growth_incomplete</span>, npc <span class='op'>=</span> <span class='fl'>2</span>, family <span class='op'>=</span> <span class='st'>"gaussian"</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using the first 2 FPCs which explain 73.8% of the (approximated) total variance.</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>fpca_obj</span><span class='op'>)</span></span>
<span class='r-plt'><img src='gfpca_twoStep-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># estimate npc adaptively, to explain 90% of the overall variation</span></span>
<span class='r-in'><span class='va'>fpca_obj2</span> <span class='op'>=</span> <span class='fu'>gfpca_twoStep</span><span class='op'>(</span>Y <span class='op'>=</span> <span class='va'>growth_incomplete</span>, npc_criterion <span class='op'>=</span> <span class='fl'>0.9</span>, family <span class='op'>=</span> <span class='st'>"gaussian"</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using the first 4 FPCs which explain 95.1% of the (approximated) total variance.</span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>fpca_obj2</span>, plot_FPCs <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-plt'><img src='gfpca_twoStep-2.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Julia Wrobel, Alexander Bauer, Jeff Goldsmith, Erin McDonnell.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


