<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Register curves using constrained optimization and GFPCA — register_fpca • registr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Register curves using constrained optimization and GFPCA — register_fpca" />
<meta property="og:description" content="Function combines constrained optimization and GFPCA to estimate warping functions for 
exponential family curves. See argument family for which families are
supported. Warping functions are calculated by the function registr.
The GFPCA step can be performed either using the variational EM-based GFPCA
approaches of Wrobel et al. (2019) (fpca_type = &quot;variationalEM&quot;, default)
or the mixed model-based two-step approach of Gertheiss et al. (2017)
(fpca_type = &quot;two-step&quot;).  
Warping functions by default are forced to start and end on the diagonal to be
domain-preserving. This behavior can be changed by setting
incompleteness to some other value than NULL and a reasonable lambda_inc value.
For further details see the accompanying vignette.  
The number of functional principal components (FPCs) can either be specified
directly (argument npc) or chosen based on the explained share of
variance in each iteration (argument npc_criterion).  
By specifying cores &amp;gt; 1 the registration call can be parallelized." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">registr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/registr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/incomplete_curves.html">Registering Incomplete Curves</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Register curves using constrained optimization and GFPCA</h1>
    
    <div class="hidden name"><code>register_fpca.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function combines constrained optimization and GFPCA to estimate warping functions for 
exponential family curves. See argument <code>family</code> for which families are
supported. Warping functions are calculated by the function <code><a href='registr.html'>registr</a></code>.
The GFPCA step can be performed either using the variational EM-based GFPCA
approaches of Wrobel et al. (2019) (<code>fpca_type = "variationalEM"</code>, default)
or the mixed model-based two-step approach of Gertheiss et al. (2017)
(<code>fpca_type = "two-step"</code>). <br /> <br />
Warping functions by default are forced to start and end on the diagonal to be
domain-preserving. This behavior can be changed by setting
<code>incompleteness</code> to some other value than NULL and a reasonable <code>lambda_inc</code> value.
For further details see the accompanying vignette. <br /> <br />
The number of functional principal components (FPCs) can either be specified
directly (argument <code>npc</code>) or chosen based on the explained share of
variance in each iteration (argument <code>npc_criterion</code>). <br /> <br />
By specifying <code>cores &gt; 1</code> the registration call can be parallelized.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>register_fpca</span><span class='op'>(</span>
  <span class='va'>Y</span>,
  Kt <span class='op'>=</span> <span class='fl'>8</span>,
  Kh <span class='op'>=</span> <span class='fl'>4</span>,
  family <span class='op'>=</span> <span class='st'>"gaussian"</span>,
  incompleteness <span class='op'>=</span> <span class='cn'>NULL</span>,
  lambda_inc <span class='op'>=</span> <span class='cn'>NULL</span>,
  Y_template <span class='op'>=</span> <span class='cn'>NULL</span>,
  max_iterations <span class='op'>=</span> <span class='fl'>10</span>,
  npc <span class='op'>=</span> <span class='cn'>NULL</span>,
  npc_criterion <span class='op'>=</span> <span class='cn'>NULL</span>,
  fpca_type <span class='op'>=</span> <span class='st'>"variationalEM"</span>,
  fpca_maxiter <span class='op'>=</span> <span class='fl'>50</span>,
  fpca_seed <span class='op'>=</span> <span class='fl'>1988</span>,
  fpca_error_thresh <span class='op'>=</span> <span class='fl'>1e-04</span>,
  fpca_index_significantDigits <span class='op'>=</span> <span class='fl'>4L</span>,
  cores <span class='op'>=</span> <span class='fl'>1L</span>,
  verbose <span class='op'>=</span> <span class='fl'>1</span>,
  <span class='va'>...</span>
<span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>Dataframe. Should have values id, value, index.</p></td>
    </tr>
    <tr>
      <th>Kt</th>
      <td><p>Number of B-spline basis functions used to estimate mean functions
and functional principal components. Default is 8. If
<code>fpca_type = "variationalEM"</code> and <code>npc_criterion</code> is used,
<code>Kt</code> is set to 20.</p></td>
    </tr>
    <tr>
      <th>Kh</th>
      <td><p>Number of B-spline basis functions used to estimate warping functions <em>h</em>. Default is 4.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>One of <code>c("gaussian","binomial","gamma","poisson")</code>.
Families <code>"gamma"</code> and <code>"poisson"</code> are only supported by
<code>fpca_type = "two-step"</code>. Defaults to <code>"gaussian"</code>.</p></td>
    </tr>
    <tr>
      <th>incompleteness</th>
      <td><p>Optional specification of incompleteness structure.
One of <code>c("leading","trailing","full")</code>, specifying that incompleteness
is present only in the initial measurements, only in the trailing measurements, or
in both, respectively. For details see the accompanying vignette.
Defaults to NULL, i.e. no incompleteness structure.
Can only be set when <code>warping = "nonparametric"</code>.</p></td>
    </tr>
    <tr>
      <th>lambda_inc</th>
      <td><p>Penalization parameter to control the amount of
overall dilation of the domain.
The higher this lambda, the more the registered domains are forced to have the
same length as the observed domains.
Only used if <code>incompleteness</code> is not NULL.</p></td>
    </tr>
    <tr>
      <th>Y_template</th>
      <td><p>Optional dataframe with the same structure as <code>Y</code>.
Only used for the initial registration step. If NULL,
curves are registered to the overall mean of all curves in <code>Y</code> as template function.
If specified, the template function is taken as the mean
of all curves in <code>Y_template</code>. Defaults to NULL.</p></td>
    </tr>
    <tr>
      <th>max_iterations</th>
      <td><p>Number of iterations for overall algorithm. Defaults to 10.</p></td>
    </tr>
    <tr>
      <th>npc, npc_criterion</th>
      <td><p>The number of functional principal components (FPCs)
has to be specified either directly as <code>npc</code> or based on their explained
share of variance. In the latter case, <code>npc_criterion</code> has to be set
to a number between 0 and 1. For <code>fpca_type = "two-step"</code>, it is also
possible to cut off potential tails of subordinate FPCs (see
<code><a href='gfpca_twoStep.html'>gfpca_twoStep</a></code> for details).</p></td>
    </tr>
    <tr>
      <th>fpca_type</th>
      <td><p>One of <code>c("variationalEM","two-step")</code>.
Defaults to <code>"variationalEM"</code>.</p></td>
    </tr>
    <tr>
      <th>fpca_maxiter</th>
      <td><p>Only used if <code>fpca_type = "variationalEM"</code>. Number
to pass to the <code>maxiter</code> argument of `bfpca()` or `fpca_gauss()`. 
Defaults to 50.</p></td>
    </tr>
    <tr>
      <th>fpca_seed</th>
      <td><p>Only used if <code>fpca_type = "variationalEM"</code>. Number to
pass to the <code>seed</code> argument of `bfpca()` or `fpca_gauss()`. Defaults to
1988.</p></td>
    </tr>
    <tr>
      <th>fpca_error_thresh</th>
      <td><p>Only used if <code>fpca_type = "variationalEM"</code>.
Number to pass to the <code>error_thresh</code> argument of `bfpca()` or
`fpca_gauss()`. Defaults to 0.0001.</p></td>
    </tr>
    <tr>
      <th>fpca_index_significantDigits</th>
      <td><p>Only used if <code>fpca_type = "two-step"</code>.
Positive integer <code>&gt;= 2</code>, stating the number of significant digits to which
the index grid should be rounded in the GFPCA step. Coarsening the index grid
is necessary since otherwise the covariance surface matrix explodes in size
in the presence of too many unique index values (which is the case after some
registration step). Defaults to 4. Set to <code>NULL</code> to prevent rounding.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>Number of cores to be used. If <code>cores &gt; 1</code>, the registration
call is parallelized by using <code><a href='https://rdrr.io/r/parallel/mclapply.html'>parallel::mclapply</a></code> (for Unix-based
systems) or <code><a href='https://rdrr.io/r/parallel/clusterApply.html'>parallel::parLapply</a></code> (for Windows). Defaults to 1,
no parallelized call.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Can be set to integers between 0 and 4 to control the level of
detail of the printed diagnostic messages. Higher numbers lead to more detailed
messages. Defaults to 1.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to registr and to the gfpca functions
(if <code>fpca_type = "variationalEM"</code>).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>registration</code> containing:</p>
<dt>Y</dt><dd><p>The observed data plus variables <code>t_star</code> and <code>t_hat</code> which are the
unregistered grid and registered grid, respectively.</p></dd>
<dt>fpca_obj</dt><dd><p>List of items from FPCA step.</p></dd>
<dt>family</dt><dd><p>Used exponential family.</p></dd>
<dt>index_warped</dt><dd><p>List of the (warped) index values for each iteration.
Has <code>'convergence$iterations + 2'</code> elements since the first two elements
contain the original (observed) index and the warped index values from the
preprocessing registration step (see Details), respectively.</p></dd>
<dt>hinv_innerKnots</dt><dd><p>List of inner knots for setting up the spline bases
for the inverse warping functions. Only contains <code>NULL</code> values for
<code>Kh &lt;= 4</code>.</p></dd>
<dt>hinv_beta</dt><dd><p>Matrix of B-spline basis coefficients used to construct the
subject-specific inverse warping functions. From the last performed
registration step. For details see <code><a href='registr.html'>?registr</a></code>.</p></dd>
<dt>convergence</dt><dd><p>List with information on the convergence of the joint
approach. Containing the following elements: <br /> <br />
<em>converged</em> <br />
Indicator if the joint algorithm converged or if not
(i.e., <code>max_iterations</code> was reached) <br /> <br />
<em>iterations</em> <br />
Number of joint iterations that were performed. <br /> <br />
<em>delta_index</em> <br />
Vector of mean squared differences between the (warped) index values
(scaled to [0,1] based on the size of the observed domain)
in the current and the previous iteration.
Convergence is reached if this measure drops below 0.0001. <br /> <br />
<em>registration_loss</em> <br />
Vector of the loss in each iteration of the algorithm.
Calculated in the registration step using the exponential family
likelihood with natural parameter from the FPCA step.
Has <code>'iterations + 1'</code> elements since the first element contains the
loss of the preprocessing registration step (see Details).</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Requires input data <code>Y</code> to be a dataframe in long format with variables 
<code>id</code>, <code>index</code>, and <code>value</code> to indicate subject IDs, 
observation times on the domain, and observations, respectively.</p>
<p>One joint iteration consists of a GFPCA step and a registration step.
As preprocessing, one initial registration step is performed.
The template function for this registration step is defined by argument
<code>Y_template</code>.
After convergence or <code>max_iterations</code> is reached, one final GFPCA step
is performed.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Julia Wrobel <a href='mailto:julia.wrobel@cuanschutz.edu'>julia.wrobel@cuanschutz.edu</a>
Jeff Goldsmith <a href='mailto:ajg2202@cumc.columbia.edu'>ajg2202@cumc.columbia.edu</a>,
Alexander Bauer <a href='mailto:alexander.bauer@stat.uni-muenchen.de'>alexander.bauer@stat.uni-muenchen.de</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'></span>
<span class='r-in'><span class='co'>### complete binomial curves</span></span>
<span class='r-in'><span class='va'>Y</span> <span class='op'>=</span> <span class='fu'><a href='simulate_unregistered_curves.html'>simulate_unregistered_curves</a></span><span class='op'>(</span>I <span class='op'>=</span> <span class='fl'>20</span>, D <span class='op'>=</span> <span class='fl'>200</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># estimation based on Wrobel et al. (2019)</span></span>
<span class='r-in'><span class='va'>reg</span> <span class='op'>=</span> <span class='fu'>register_fpca</span><span class='op'>(</span><span class='va'>Y</span>, npc <span class='op'>=</span> <span class='fl'>2</span>, family <span class='op'>=</span> <span class='st'>"binomial"</span>,</span>
<span class='r-in'>                    fpca_type <span class='op'>=</span> <span class='st'>"variationalEM"</span>, max_iterations <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running initial registration step</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> current iteration: 1</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running final FPCA step</span>
<span class='r-in'><span class='co'># estimation based on Gertheiss et al. (2017)</span></span>
<span class='r-in'><span class='va'>reg2</span> <span class='op'>=</span> <span class='fu'>register_fpca</span><span class='op'>(</span><span class='va'>Y</span>, npc <span class='op'>=</span> <span class='fl'>2</span>, family <span class='op'>=</span> <span class='st'>"binomial"</span>,</span>
<span class='r-in'>                     fpca_type <span class='op'>=</span> <span class='st'>"two-step"</span>, max_iterations <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span class='r-in'>                     fpca_index_significantDigits <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running initial registration step</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> current iteration: 1</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using the first 2 FPCs which explain 64% of the (approximated) total variance.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running final FPCA step</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using the first 2 FPCs which explain 64.5% of the (approximated) total variance.</span>
<span class='r-in'></span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"ggplot2"</span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>reg</span><span class='op'>$</span><span class='va'>Y</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>tstar</span>, y <span class='op'>=</span> <span class='va'>t_hat</span>, group <span class='op'>=</span> <span class='va'>id</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span class='r-in'>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Estimated warping functions"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>reg</span><span class='op'>$</span><span class='va'>fpca_obj</span>, response_function <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='op'>{</span> <span class='fl'>1</span> <span class='op'>/</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>}</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-plt'><img src='register_fpca-1.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># \donttest{ </span></span>
<span class='r-in'><span class='co'># example using accelerometer data from nhanes 2003-2004 study</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>nhanes</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>nhanes_short</span> <span class='op'>=</span> <span class='va'>nhanes</span><span class='op'>[</span><span class='va'>nhanes</span><span class='op'>$</span><span class='va'>id</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>nhanes</span><span class='op'>$</span><span class='va'>id</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>]</span>,<span class='op'>]</span></span>
<span class='r-in'><span class='va'>reg_nhanes</span>   <span class='op'>=</span> <span class='fu'>register_fpca</span><span class='op'>(</span><span class='va'>nhanes_short</span>, npc <span class='op'>=</span> <span class='fl'>2</span>, family <span class='op'>=</span> <span class='st'>"binomial"</span>, max_iterations <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running initial registration step</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> current iteration: 1</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>BFPCA convergence not reached. Try increasing maxiter.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> current iteration: 2</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>BFPCA convergence not reached. Try increasing maxiter.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running final FPCA step</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>BFPCA convergence not reached. Try increasing maxiter.</span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>### incomplete Gaussian curves</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>growth_incomplete</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Force the warping functions to start and end on the diagonal</span></span>
<span class='r-in'><span class='va'>reg2a</span> <span class='op'>=</span> <span class='fu'>register_fpca</span><span class='op'>(</span><span class='va'>growth_incomplete</span>, npc <span class='op'>=</span> <span class='fl'>2</span>, family <span class='op'>=</span> <span class='st'>"gaussian"</span>,</span>
<span class='r-in'>                      incompleteness <span class='op'>=</span> <span class='cn'>NULL</span>, max_iterations <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running initial registration step</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> current iteration: 1</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> current iteration: 2</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>fpca_gauss convergence not reached. Try increasing maxiter.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running final FPCA step</span>
<span class='r-wrn co'><span class='r-pr'>#&gt;</span> <span class='warning'>Warning: </span>fpca_gauss convergence not reached. Try increasing maxiter.</span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"ggplot2"</span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>reg2a</span><span class='op'>$</span><span class='va'>Y</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>tstar</span>, y <span class='op'>=</span> <span class='va'>t_hat</span>, group <span class='op'>=</span> <span class='va'>id</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span class='r-in'>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span class='r-in'>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Estimated warping functions"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>reg2a</span><span class='op'>$</span><span class='va'>Y</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>t_hat</span>, y <span class='op'>=</span> <span class='va'>value</span>, group <span class='op'>=</span> <span class='va'>id</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span class='r-in'>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span class='r-in'>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Registered curves"</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-plt'><img src='register_fpca-2.png' alt='' width='700' height='433' /></span>
<span class='r-in'><span class='co'># Allow the warping functions to not start / end on the diagonal.</span></span>
<span class='r-in'><span class='co'># The higher lambda_inc, the more the starting points and endpoints are forced</span></span>
<span class='r-in'><span class='co'># towards the diagonal.</span></span>
<span class='r-in'><span class='va'>reg2b</span> <span class='op'>=</span> <span class='fu'>register_fpca</span><span class='op'>(</span><span class='va'>growth_incomplete</span>, npc <span class='op'>=</span> <span class='fl'>2</span>, family <span class='op'>=</span> <span class='st'>"gaussian"</span>,</span>
<span class='r-in'>                      incompleteness <span class='op'>=</span> <span class='st'>"full"</span>, lambda_inc <span class='op'>=</span> <span class='fl'>0.1</span>,</span>
<span class='r-in'>                      max_iterations <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running initial registration step</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> current iteration: 1</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> current iteration: 2</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running final FPCA step</span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span><span class='op'>(</span><span class='st'>"ggplot2"</span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>reg2b</span><span class='op'>$</span><span class='va'>Y</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>tstar</span>, y <span class='op'>=</span> <span class='va'>t_hat</span>, group <span class='op'>=</span> <span class='va'>id</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span class='r-in'>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span class='r-in'>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Estimated warping functions"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>reg2b</span><span class='op'>$</span><span class='va'>Y</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>t_hat</span>, y <span class='op'>=</span> <span class='va'>value</span>, group <span class='op'>=</span> <span class='va'>id</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span></span>
<span class='r-in'>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span> <span class='op'>+</span></span>
<span class='r-in'>    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='st'>"Registered curves"</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-plt'><img src='register_fpca-3.png' alt='' width='700' height='433' /></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>### complete Gamma curves</span></span>
<span class='r-in'><span class='va'>Y</span>             <span class='op'>=</span> <span class='fu'><a href='simulate_unregistered_curves.html'>simulate_unregistered_curves</a></span><span class='op'>(</span>I <span class='op'>=</span> <span class='fl'>20</span>, D <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>Y</span><span class='op'>$</span><span class='va'>value</span>       <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='va'>Y</span><span class='op'>$</span><span class='va'>latent_mean</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>registr_gamma</span> <span class='op'>=</span> <span class='fu'>register_fpca</span><span class='op'>(</span><span class='va'>Y</span>, npc <span class='op'>=</span> <span class='fl'>2</span>, family <span class='op'>=</span> <span class='st'>"gamma"</span>, fpca_type <span class='op'>=</span> <span class='st'>"two-step"</span>,</span>
<span class='r-in'>                              gradient <span class='op'>=</span> <span class='cn'>FALSE</span>, max_iterations <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span></span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running initial registration step</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> current iteration: 1</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using the first 2 FPCs which explain 99.6% of the (approximated) total variance.</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Running final FPCA step</span>
<span class='r-msg co'><span class='r-pr'>#&gt;</span> Using the first 2 FPCs which explain 99.8% of the (approximated) total variance.</span>
<span class='r-in'><span class='co'># }</span></span>
<span class='r-in'></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Julia Wrobel, Alexander Bauer, Jeff Goldsmith, Erin McDonnell.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


